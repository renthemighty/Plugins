<?xml version="1.0" encoding="utf-8"?>
<!--
    Kira Network Security Configuration

    Policy:
    1. Cleartext (HTTP) traffic is globally disallowed.
    2. Certificate pinning is applied ONLY to the Kira backend domain.
       Third-party APIs (Google, Dropbox, Microsoft, Box, Intuit) use
       standard system CA validation. Pinning their certificates would
       break when those providers rotate certs.
    3. System-installed CAs are trusted for all connections.
    4. Debug builds additionally trust user-installed CAs (for proxy
       inspection during development).
-->
<network-security-config>

    <!-- Global: disallow cleartext traffic for all domains -->
    <base-config cleartextTrafficPermitted="false">
        <trust-anchors>
            <certificates src="system" />
        </trust-anchors>
    </base-config>

    <!--
        Kira Backend: certificate pinning.
        Pins include the leaf certificate and one intermediate CA to
        allow for routine leaf rotation without app updates.

        Pin expiration is set to ensure the app does not become
        permanently bricked if pins expire before an update is pushed.
        After expiration, the app falls back to standard CA validation.

        Replace these placeholder hashes with actual SHA-256 SPKI pin
        digests from your Kira backend TLS certificate chain.
    -->
    <domain-config>
        <domain includeSubdomains="true">api.kira.example.com</domain>
        <domain includeSubdomains="true">auth.kira.example.com</domain>
        <pin-set expiration="2027-01-01">
            <!-- Leaf certificate pin (SHA-256 SPKI digest) -->
            <pin digest="SHA-256">REPLACE_WITH_LEAF_CERT_SHA256_SPKI_HASH=</pin>
            <!-- Intermediate CA pin (backup; allows leaf rotation) -->
            <pin digest="SHA-256">REPLACE_WITH_INTERMEDIATE_CA_SHA256_SPKI_HASH=</pin>
        </pin-set>
        <trust-anchors>
            <certificates src="system" />
        </trust-anchors>
    </domain-config>

    <!--
        Debug overrides: allow user-installed CAs in debug builds
        so developers can use tools like Charles Proxy or mitmproxy
        for network inspection during development.
    -->
    <debug-overrides>
        <trust-anchors>
            <certificates src="system" />
            <certificates src="user" />
        </trust-anchors>
    </debug-overrides>

</network-security-config>
